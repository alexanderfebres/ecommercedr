{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\Alexander\\\\Desktop\\\\important\\\\ecommerceproject\\\\root\\\\src\\\\containers\\\\Checkout.js\";\nimport React from \"react\";\nimport { CardElement, ElementsConsumer } from \"@stripe/react-stripe-js\";\nimport { Link } from \"react-router-dom\";\nimport { Elements } from \"@stripe/react-stripe-js\";\nimport { loadStripe } from \"@stripe/stripe-js\";\nimport { Button, Container, Divider, Dimmer, Header, Item, Image, Label, Loader, Message, Segment, Form } from \"semantic-ui-react\";\nimport { checkoutURL, orderSummaryURL, addCouponURL, addressListURL } from \"../containers/constants\";\nimport { authAxios } from \"../Utils\";\nconst stripePromise = loadStripe(\"pk_test_51Ha0vNGV70HGHFAGYq6tdL9DjEXnL6uslIYoVA7TLvwLhW1EHWUWiMh0KM4PEkxkzCsy6Y0mbkjAdXCBzlPzJVbx00Mtss3kPN\");\n\nconst OrderPreview = props => {\n  const {\n    data\n  } = props;\n  return /*#__PURE__*/React.createElement(React.Fragment, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 39,\n      columnNumber: 5\n    }\n  }, data && /*#__PURE__*/React.createElement(React.Fragment, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 41,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Item.Group, {\n    relaxed: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 42,\n      columnNumber: 11\n    }\n  }, data.order_items.map((order_item, i) => {\n    return /*#__PURE__*/React.createElement(Item, {\n      key: i,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 45,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(Item.Image, {\n      size: \"tiny\",\n      src: `http://127.0.0.1:8000${order_item.item.image}`,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 46,\n        columnNumber: 19\n      }\n    }), /*#__PURE__*/React.createElement(Item.Content, {\n      verticalAlign: \"middle\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 51,\n        columnNumber: 19\n      }\n    }, /*#__PURE__*/React.createElement(Item.Header, {\n      as: \"a\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 52,\n        columnNumber: 21\n      }\n    }, order_item.quantity, \" x \", order_item.item.title), /*#__PURE__*/React.createElement(Item.Extra, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 56,\n        columnNumber: 21\n      }\n    }, /*#__PURE__*/React.createElement(Label, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 57,\n        columnNumber: 23\n      }\n    }, \"$ \", order_item.final_price))));\n  })), /*#__PURE__*/React.createElement(Item.Group, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 65,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(Item.Content, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 66,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(Item.Header, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 67,\n      columnNumber: 15\n    }\n  }, \"Order Total: $\", data.total, data.coupon && /*#__PURE__*/React.createElement(Label, {\n    color: \"green\",\n    style: {\n      marginLeft: \"15px\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 70,\n      columnNumber: 19\n    }\n  }, \"Current Coupon: \", data.coupon.code, \" for $\", data.coupon.amount))))));\n};\n\nclass CouponForm extends React.Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      code: \"\"\n    };\n\n    this.handleChange = e => {\n      this.setState({\n        code: e.target.value\n      });\n    };\n\n    this.handleSubmit = e => {\n      const {\n        code\n      } = this.state;\n      this.props.handleAddCoupon(e, code);\n      this.setState({\n        code: \"\"\n      });\n    };\n  }\n\n  render() {\n    const {\n      code\n    } = this.state;\n    return /*#__PURE__*/React.createElement(React.Fragment, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 101,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(Form, {\n      onSubmit: this.handleSubmit,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 102,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(Form.Field, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 103,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"label\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 104,\n        columnNumber: 13\n      }\n    }, \"Coupong Code\"), /*#__PURE__*/React.createElement(\"input\", {\n      placeholder: \"Enter a coupon\",\n      value: code,\n      onChange: this.handleChange,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 105,\n        columnNumber: 13\n      }\n    })), /*#__PURE__*/React.createElement(Button, {\n      type: \"submit\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 111,\n        columnNumber: 11\n      }\n    }, \"Submit\")));\n  }\n\n}\n\nclass CheckoutForm extends React.Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      loading: true,\n      error: null,\n      success: false,\n      data: null,\n      billing: null,\n      shipping: null\n    };\n\n    this.handleFetchBillingAddress = () => {\n      this.setState({\n        loading: true\n      });\n      authAxios.get(addressListURL(\"B\")).then(res => {\n        this.setState({\n          billing: res.data,\n          loading: false\n        });\n      }).catch(err => {\n        this.setState({\n          error: err\n        });\n      });\n    };\n\n    this.handleFetchShippingAddress = () => {\n      this.setState({\n        loading: true\n      });\n      authAxios.get(addressListURL(\"S\")).then(res => {\n        this.setState({\n          shipping: res.data,\n          loading: false\n        });\n        console.log();\n      }).catch(err => {\n        this.setState({\n          error: err\n        });\n      });\n    };\n\n    this.handleFetchOrder = () => {\n      this.setState({\n        loading: true\n      });\n      authAxios.get(orderSummaryURL).then(res => {\n        this.setState({\n          data: res.data,\n          loading: false\n        });\n      }).catch(err => {\n        if (err.response.status === 404) {\n          this.props.history.push(\"/products\");\n        } else {\n          this.setState({\n            error: err,\n            loading: false\n          });\n        }\n      });\n    };\n\n    this.handleAddCoupon = (e, code) => {\n      e.preventDefault();\n      this.setState({\n        loading: true\n      });\n      authAxios.post(addCouponURL, {\n        code\n      }).then(res => {\n        this.setState({\n          loading: false\n        });\n        this.handleFetchOrder();\n      }).catch(err => {\n        this.setState({\n          error: err,\n          loading: false\n        });\n      });\n    };\n\n    this.handleSubmit = async event => {\n      // Block native form submission.\n      event.preventDefault();\n      const {\n        stripe,\n        elements\n      } = this.props;\n\n      if (!stripe || !elements) {\n        // Stripe.js has not loaded yet. Make sure to disable\n        // form submission until Stripe.js has loaded.\n        return;\n      }\n\n      this.setState({\n        loading: true\n      }); // Get a reference to a mounted CardElement. Elements knows how\n      // to find your CardElement because there can only ever be one of\n      // each type of element.\n\n      const cardElement = elements.getElement(CardElement);\n      const {\n        error,\n        paymentMethod\n      } = await stripe.createPaymentMethod({\n        type: \"card\",\n        card: cardElement\n      });\n      authAxios.post(checkoutURL, {\n        stripeToken: paymentMethod.card\n      }).then(res => {\n        this.setState({\n          loading: false,\n          success: true\n        });\n      }).catch(err => {\n        this.setState({\n          loading: false,\n          error: err\n        });\n      });\n\n      if (error) {\n        console.log(\"[error]\", error);\n      } else {\n        console.log(\"[PaymentMethod]\", paymentMethod);\n      }\n    };\n  }\n\n  componentDidMount() {\n    this.handleFetchOrder();\n    this.handleFetchBillingAddress();\n    this.handleFetchShippingAddress();\n  }\n\n  render() {\n    const {\n      stripe\n    } = this.props;\n    const {\n      data,\n      error,\n      loading,\n      success,\n      shipping,\n      billing\n    } = this.state; // console.log(shipping, billing);\n\n    return /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 232,\n        columnNumber: 7\n      }\n    }, error && /*#__PURE__*/React.createElement(Message, {\n      error: true,\n      header: \"There was some errors with your submission\",\n      content: JSON.stringify(error),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 234,\n        columnNumber: 11\n      }\n    }), loading && /*#__PURE__*/React.createElement(Segment, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 241,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(Dimmer, {\n      active: true,\n      inverted: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 242,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(Loader, {\n      inverted: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 243,\n        columnNumber: 15\n      }\n    }, \"Loading\")), /*#__PURE__*/React.createElement(Image, {\n      src: \"/images/wireframe/short-paragraph.png\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 246,\n        columnNumber: 13\n      }\n    })), success && /*#__PURE__*/React.createElement(Message, {\n      positive: true,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 250,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(Message.Header, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 251,\n        columnNumber: 13\n      }\n    }, \"Your payment was successful\"), /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 252,\n        columnNumber: 13\n      }\n    }, \"Go to you profile \", /*#__PURE__*/React.createElement(\"b\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 253,\n        columnNumber: 33\n      }\n    }, \"profile\"), \" to see the order delivery status.\")), /*#__PURE__*/React.createElement(OrderPreview, {\n      data: data,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 257,\n        columnNumber: 9\n      }\n    }), /*#__PURE__*/React.createElement(Divider, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 258,\n        columnNumber: 9\n      }\n    }), /*#__PURE__*/React.createElement(CouponForm, {\n      handleAddCoupon: (e, code) => this.handleAddCoupon(e, code),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 259,\n        columnNumber: 9\n      }\n    }), /*#__PURE__*/React.createElement(Divider, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 262,\n        columnNumber: 9\n      }\n    }), billing && shipping ? /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 265,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(Header, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 266,\n        columnNumber: 13\n      }\n    }, \"Would you like to complete the purshavse ?\"), /*#__PURE__*/React.createElement(\"form\", {\n      onSubmit: this.handleSubmit,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 268,\n        columnNumber: 13\n      }\n    }, /*#__PURE__*/React.createElement(CardElement, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 269,\n        columnNumber: 15\n      }\n    }), /*#__PURE__*/React.createElement(Button, {\n      secondary: true,\n      type: \"submit\",\n      disabled: !stripe,\n      style: {\n        marginTop: \"10px\"\n      } // loading={loading}\n      // disabled={loading}\n      ,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 271,\n        columnNumber: 15\n      }\n    }, \"Pay\"))) : /*#__PURE__*/React.createElement(\"div\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 284,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(Link, {\n      to: \"/profile\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 285,\n        columnNumber: 13\n      }\n    }, \" \", /*#__PURE__*/React.createElement(Header, {\n      as: \"h5\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 287,\n        columnNumber: 15\n      }\n    }, \"In order to process your payment you need to provide you shipping and billing addresses first\"))));\n  }\n\n}\n\nconst InjectedCheckoutForm = () => {\n  return /*#__PURE__*/React.createElement(Container, {\n    text: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 301,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"h3\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 302,\n      columnNumber: 7\n    }\n  }, \"Complete your Order\"), /*#__PURE__*/React.createElement(Elements, {\n    stripe: stripePromise,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 303,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(ElementsConsumer, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 304,\n      columnNumber: 9\n    }\n  }, ({\n    elements,\n    stripe\n  }) => /*#__PURE__*/React.createElement(CheckoutForm, {\n    elements: elements,\n    stripe: stripe,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 306,\n      columnNumber: 13\n    }\n  }))));\n};\n\nexport default InjectedCheckoutForm;","map":{"version":3,"sources":["C:/Users/Alexander/Desktop/important/ecommerceproject/root/src/containers/Checkout.js"],"names":["React","CardElement","ElementsConsumer","Link","Elements","loadStripe","Button","Container","Divider","Dimmer","Header","Item","Image","Label","Loader","Message","Segment","Form","checkoutURL","orderSummaryURL","addCouponURL","addressListURL","authAxios","stripePromise","OrderPreview","props","data","order_items","map","order_item","i","item","image","quantity","title","final_price","total","coupon","marginLeft","code","amount","CouponForm","Component","state","handleChange","e","setState","target","value","handleSubmit","handleAddCoupon","render","CheckoutForm","loading","error","success","billing","shipping","handleFetchBillingAddress","get","then","res","catch","err","handleFetchShippingAddress","console","log","handleFetchOrder","response","status","history","push","preventDefault","post","event","stripe","elements","cardElement","getElement","paymentMethod","createPaymentMethod","type","card","stripeToken","componentDidMount","JSON","stringify","marginTop","InjectedCheckoutForm"],"mappings":"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","sourcesContent":["import React from \"react\";\r\nimport { CardElement, ElementsConsumer } from \"@stripe/react-stripe-js\";\r\nimport { Link } from \"react-router-dom\";\r\n\r\nimport { Elements } from \"@stripe/react-stripe-js\";\r\nimport { loadStripe } from \"@stripe/stripe-js\";\r\n\r\nimport {\r\n  Button,\r\n  Container,\r\n  Divider,\r\n  Dimmer,\r\n  Header,\r\n  Item,\r\n  Image,\r\n  Label,\r\n  Loader,\r\n  Message,\r\n  Segment,\r\n  Form,\r\n} from \"semantic-ui-react\";\r\n\r\nimport {\r\n  checkoutURL,\r\n  orderSummaryURL,\r\n  addCouponURL,\r\n  addressListURL,\r\n} from \"../containers/constants\";\r\n\r\nimport { authAxios } from \"../Utils\";\r\n\r\nconst stripePromise = loadStripe(\r\n  \"pk_test_51Ha0vNGV70HGHFAGYq6tdL9DjEXnL6uslIYoVA7TLvwLhW1EHWUWiMh0KM4PEkxkzCsy6Y0mbkjAdXCBzlPzJVbx00Mtss3kPN\"\r\n);\r\n\r\nconst OrderPreview = (props) => {\r\n  const { data } = props;\r\n  return (\r\n    <React.Fragment>\r\n      {data && (\r\n        <React.Fragment>\r\n          <Item.Group relaxed>\r\n            {data.order_items.map((order_item, i) => {\r\n              return (\r\n                <Item key={i}>\r\n                  <Item.Image\r\n                    size=\"tiny\"\r\n                    src={`http://127.0.0.1:8000${order_item.item.image}`}\r\n                  />\r\n\r\n                  <Item.Content verticalAlign=\"middle\">\r\n                    <Item.Header as=\"a\">\r\n                      {order_item.quantity} x {order_item.item.title}\r\n                    </Item.Header>\r\n\r\n                    <Item.Extra>\r\n                      <Label>$ {order_item.final_price}</Label>\r\n                    </Item.Extra>\r\n                  </Item.Content>\r\n                </Item>\r\n              );\r\n            })}\r\n          </Item.Group>\r\n\r\n          <Item.Group>\r\n            <Item.Content>\r\n              <Item.Header>\r\n                Order Total: ${data.total}\r\n                {data.coupon && (\r\n                  <Label color=\"green\" style={{ marginLeft: \"15px\" }}>\r\n                    Current Coupon: {data.coupon.code} for ${data.coupon.amount}\r\n                  </Label>\r\n                )}\r\n              </Item.Header>\r\n            </Item.Content>\r\n          </Item.Group>\r\n        </React.Fragment>\r\n      )}\r\n    </React.Fragment>\r\n  );\r\n};\r\n\r\nclass CouponForm extends React.Component {\r\n  state = {\r\n    code: \"\",\r\n  };\r\n\r\n  handleChange = (e) => {\r\n    this.setState({ code: e.target.value });\r\n  };\r\n\r\n  handleSubmit = (e) => {\r\n    const { code } = this.state;\r\n    this.props.handleAddCoupon(e, code);\r\n    this.setState({ code: \"\" });\r\n  };\r\n\r\n  render() {\r\n    const { code } = this.state;\r\n    return (\r\n      <React.Fragment>\r\n        <Form onSubmit={this.handleSubmit}>\r\n          <Form.Field>\r\n            <label>Coupong Code</label>\r\n            <input\r\n              placeholder=\"Enter a coupon\"\r\n              value={code}\r\n              onChange={this.handleChange}\r\n            />\r\n          </Form.Field>\r\n          <Button type=\"submit\">Submit</Button>\r\n        </Form>\r\n      </React.Fragment>\r\n    );\r\n  }\r\n}\r\n\r\nclass CheckoutForm extends React.Component {\r\n  state = {\r\n    loading: true,\r\n    error: null,\r\n    success: false,\r\n    data: null,\r\n    billing: null,\r\n    shipping: null,\r\n  };\r\n\r\n  componentDidMount() {\r\n    this.handleFetchOrder();\r\n    this.handleFetchBillingAddress();\r\n    this.handleFetchShippingAddress();\r\n  }\r\n\r\n  handleFetchBillingAddress = () => {\r\n    this.setState({ loading: true });\r\n    authAxios\r\n      .get(addressListURL(\"B\"))\r\n      .then((res) => {\r\n        this.setState({ billing: res.data, loading: false });\r\n      })\r\n      .catch((err) => {\r\n        this.setState({ error: err });\r\n      });\r\n  };\r\n\r\n  handleFetchShippingAddress = () => {\r\n    this.setState({ loading: true });\r\n    authAxios\r\n      .get(addressListURL(\"S\"))\r\n      .then((res) => {\r\n        this.setState({ shipping: res.data, loading: false });\r\n        console.log()\r\n      })\r\n      .catch((err) => {\r\n        this.setState({ error: err });\r\n      });\r\n  };\r\n\r\n  handleFetchOrder = () => {\r\n    this.setState({ loading: true });\r\n    authAxios\r\n      .get(orderSummaryURL)\r\n      .then((res) => {\r\n        this.setState({ data: res.data, loading: false });\r\n      })\r\n      .catch((err) => {\r\n        if (err.response.status === 404) {\r\n          this.props.history.push(\"/products\");\r\n        } else {\r\n          this.setState({ error: err, loading: false });\r\n        }\r\n      });\r\n  };\r\n  handleAddCoupon = (e, code) => {\r\n    e.preventDefault();\r\n    this.setState({ loading: true });\r\n\r\n    authAxios\r\n      .post(addCouponURL, { code })\r\n      .then((res) => {\r\n        this.setState({ loading: false });\r\n        this.handleFetchOrder();\r\n      })\r\n      .catch((err) => {\r\n        this.setState({ error: err, loading: false });\r\n      });\r\n  };\r\n\r\n  handleSubmit = async (event) => {\r\n    // Block native form submission.\r\n    event.preventDefault();\r\n\r\n    const { stripe, elements } = this.props;\r\n\r\n    if (!stripe || !elements) {\r\n      // Stripe.js has not loaded yet. Make sure to disable\r\n      // form submission until Stripe.js has loaded.\r\n      return;\r\n    }\r\n\r\n    this.setState({ loading: true });\r\n    // Get a reference to a mounted CardElement. Elements knows how\r\n    // to find your CardElement because there can only ever be one of\r\n    // each type of element.\r\n    const cardElement = elements.getElement(CardElement);\r\n\r\n    const { error, paymentMethod } = await stripe.createPaymentMethod({\r\n      type: \"card\",\r\n      card: cardElement,\r\n    });\r\n    authAxios\r\n      .post(checkoutURL, { stripeToken: paymentMethod.card })\r\n      .then((res) => {\r\n        this.setState({ loading: false, success: true });\r\n      })\r\n      .catch((err) => {\r\n        this.setState({ loading: false, error: err });\r\n      });\r\n\r\n    if (error) {\r\n      console.log(\"[error]\", error);\r\n    } else {\r\n      console.log(\"[PaymentMethod]\", paymentMethod);\r\n    }\r\n  };\r\n\r\n  render() {\r\n    const { stripe } = this.props;\r\n    const { data, error, loading, success, shipping, billing } = this.state;\r\n    // console.log(shipping, billing);\r\n    return (\r\n      <div>\r\n        {error && (\r\n          <Message\r\n            error\r\n            header=\"There was some errors with your submission\"\r\n            content={JSON.stringify(error)}\r\n          />\r\n        )}\r\n        {loading && (\r\n          <Segment>\r\n            <Dimmer active inverted>\r\n              <Loader inverted>Loading</Loader>\r\n            </Dimmer>\r\n\r\n            <Image src=\"/images/wireframe/short-paragraph.png\" />\r\n          </Segment>\r\n        )}\r\n        {success && (\r\n          <Message positive>\r\n            <Message.Header>Your payment was successful</Message.Header>\r\n            <p>\r\n              Go to you profile <b>profile</b> to see the order delivery status.\r\n            </p>\r\n          </Message>\r\n        )}\r\n        <OrderPreview data={data} />\r\n        <Divider />\r\n        <CouponForm\r\n          handleAddCoupon={(e, code) => this.handleAddCoupon(e, code)}\r\n        />\r\n        <Divider />\r\n\r\n        {billing && shipping ? (\r\n          <div>\r\n            <Header>Would you like to complete the purshavse ?</Header>\r\n\r\n            <form onSubmit={this.handleSubmit}>\r\n              <CardElement />\r\n\r\n              <Button\r\n                secondary\r\n                type=\"submit\"\r\n                disabled={!stripe}\r\n                style={{ marginTop: \"10px\" }}\r\n                // loading={loading}\r\n                // disabled={loading}\r\n              >\r\n                Pay\r\n              </Button>\r\n            </form>\r\n          </div>\r\n        ) : (\r\n          <div>\r\n            <Link to=\"/profile\">\r\n              {\" \"}\r\n              <Header as=\"h5\">\r\n                In order to process your payment you need to provide you\r\n                shipping and billing addresses first\r\n              </Header>\r\n            </Link>\r\n          </div>\r\n        )}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nconst InjectedCheckoutForm = () => {\r\n  return (\r\n    <Container text>\r\n      <h3>Complete your Order</h3>\r\n      <Elements stripe={stripePromise}>\r\n        <ElementsConsumer>\r\n          {({ elements, stripe }) => (\r\n            <CheckoutForm elements={elements} stripe={stripe} />\r\n          )}\r\n        </ElementsConsumer>\r\n      </Elements>\r\n    </Container>\r\n  );\r\n};\r\n\r\nexport default InjectedCheckoutForm;\r\n"]},"metadata":{},"sourceType":"module"}