{"ast":null,"code":"import _regeneratorRuntime from\"C:\\\\Users\\\\Alexander\\\\Desktop\\\\important\\\\ecommerceproject\\\\root\\\\front\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _asyncToGenerator from\"C:\\\\Users\\\\Alexander\\\\Desktop\\\\important\\\\ecommerceproject\\\\root\\\\front\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"C:\\\\Users\\\\Alexander\\\\Desktop\\\\important\\\\ecommerceproject\\\\root\\\\front\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _createClass from\"C:\\\\Users\\\\Alexander\\\\Desktop\\\\important\\\\ecommerceproject\\\\root\\\\front\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import _inherits from\"C:\\\\Users\\\\Alexander\\\\Desktop\\\\important\\\\ecommerceproject\\\\root\\\\front\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";import _createSuper from\"C:\\\\Users\\\\Alexander\\\\Desktop\\\\important\\\\ecommerceproject\\\\root\\\\front\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createSuper\";import React from\"react\";import{CardElement,ElementsConsumer}from\"@stripe/react-stripe-js\";import{Link}from\"react-router-dom\";import{Elements}from\"@stripe/react-stripe-js\";import{loadStripe}from\"@stripe/stripe-js\";import{Button,Container,Divider,Dimmer,Header,Item,Image,Label,Loader,Message,Segment,Form}from\"semantic-ui-react\";import{checkoutURL,orderSummaryURL,addCouponURL,addressListURL}from\"../containers/constants\";import{authAxios}from\"../Utils\";var stripePromise=loadStripe(\"pk_test_51Ha0vNGV70HGHFAGYq6tdL9DjEXnL6uslIYoVA7TLvwLhW1EHWUWiMh0KM4PEkxkzCsy6Y0mbkjAdXCBzlPzJVbx00Mtss3kPN\");var OrderPreview=function OrderPreview(props){var data=props.data;return/*#__PURE__*/React.createElement(React.Fragment,null,data&&/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(Item.Group,{relaxed:true},data.order_items.map(function(order_item,i){return/*#__PURE__*/React.createElement(Item,{key:i},/*#__PURE__*/React.createElement(Item.Image,{size:\"tiny\",src:\"http://127.0.0.1:8000\".concat(order_item.item.image)}),/*#__PURE__*/React.createElement(Item.Content,{verticalAlign:\"middle\"},/*#__PURE__*/React.createElement(Item.Header,{as:\"a\"},order_item.quantity,\" x \",order_item.item.title),/*#__PURE__*/React.createElement(Item.Extra,null,/*#__PURE__*/React.createElement(Label,null,\"$ \",order_item.final_price))));})),/*#__PURE__*/React.createElement(Item.Group,null,/*#__PURE__*/React.createElement(Item.Content,null,/*#__PURE__*/React.createElement(Item.Header,null,\"Order Total: $\",data.total,data.coupon&&/*#__PURE__*/React.createElement(Label,{color:\"green\",style:{marginLeft:\"15px\"}},\"Current Coupon: \",data.coupon.code,\" for $\",data.coupon.amount))))));};var CouponForm=/*#__PURE__*/function(_React$Component){_inherits(CouponForm,_React$Component);var _super=_createSuper(CouponForm);function CouponForm(){var _this;_classCallCheck(this,CouponForm);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={code:\"\"};_this.handleChange=function(e){_this.setState({code:e.target.value});};_this.handleSubmit=function(e){var code=_this.state.code;_this.props.handleAddCoupon(e,code);_this.setState({code:\"\"});};return _this;}_createClass(CouponForm,[{key:\"render\",value:function render(){var code=this.state.code;return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(Form,{onSubmit:this.handleSubmit},/*#__PURE__*/React.createElement(Form.Field,null,/*#__PURE__*/React.createElement(\"label\",null,\"Coupong Code\"),/*#__PURE__*/React.createElement(\"input\",{placeholder:\"Enter a coupon\",value:code,onChange:this.handleChange})),/*#__PURE__*/React.createElement(Button,{type:\"submit\"},\"Submit\")));}}]);return CouponForm;}(React.Component);var CheckoutForm=/*#__PURE__*/function(_React$Component2){_inherits(CheckoutForm,_React$Component2);var _super2=_createSuper(CheckoutForm);function CheckoutForm(){var _this2;_classCallCheck(this,CheckoutForm);for(var _len2=arguments.length,args=new Array(_len2),_key2=0;_key2<_len2;_key2++){args[_key2]=arguments[_key2];}_this2=_super2.call.apply(_super2,[this].concat(args));_this2.state={loading:true,error:null,success:false,data:null,billing:[],shipping:[]};_this2.handleFetchBillingAddress=function(){// this.setState({ loading: true });\nvar billing=_this2.state.billing;authAxios.get(addressListURL(\"B\")).then(function(res){// this.setState({ billing: res.data, loading: false });\n_this2.setState({billing:res.data});}).catch(function(err){_this2.setState({error:err});});};_this2.handleFetchShippingAddress=function(){// this.setState({ loading: true });\nvar shipping=_this2.state.shipping;authAxios.get(addressListURL(\"S\")).then(function(res){// this.setState({ shipping: res.data, loading: false });\n_this2.setState({shipping:res.data});}).catch(function(err){_this2.setState({error:err});});};_this2.handleFetchOrder=function(){_this2.setState({loading:true});authAxios.get(orderSummaryURL).then(function(res){_this2.setState({data:res.data,loading:false});_this2.handleFetchBillingAddress();_this2.handleFetchShippingAddress();}).catch(function(err){if(err.response.status===404){_this2.props.history.push(\"/products\");}else{_this2.setState({error:err,loading:false});}});};_this2.handleAddCoupon=function(e,code){e.preventDefault();_this2.setState({loading:true});authAxios.post(addCouponURL,{code:code}).then(function(res){_this2.setState({loading:false});_this2.handleFetchOrder();}).catch(function(err){_this2.setState({error:err,loading:false});});};_this2.handleSubmit=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(event){var _this2$props,stripe,elements,cardElement,_yield$stripe$createP,error,paymentMethod;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:// Block native form submission.\nevent.preventDefault();_this2$props=_this2.props,stripe=_this2$props.stripe,elements=_this2$props.elements;if(!(!stripe||!elements)){_context.next=4;break;}return _context.abrupt(\"return\");case 4:_this2.setState({loading:true});// Get a reference to a mounted CardElement. Elements knows how\n// to find your CardElement because there can only ever be one of\n// each type of element.\ncardElement=elements.getElement(CardElement);_context.next=8;return stripe.createPaymentMethod({type:\"card\",card:cardElement});case 8:_yield$stripe$createP=_context.sent;error=_yield$stripe$createP.error;paymentMethod=_yield$stripe$createP.paymentMethod;authAxios.post(checkoutURL,{stripeToken:paymentMethod.card}).then(function(res){_this2.setState({loading:false,success:true});}).catch(function(err){_this2.setState({loading:false,error:err});});if(error){console.log(\"[error]\",error);}else{console.log(\"[PaymentMethod]\",paymentMethod);}case 13:case\"end\":return _context.stop();}}},_callee);}));return function(_x){return _ref.apply(this,arguments);};}();return _this2;}_createClass(CheckoutForm,[{key:\"componentDidMount\",value:function componentDidMount(){this.handleFetchOrder();}},{key:\"render\",value:function render(){var _this3=this;var stripe=this.props.stripe;var _this$state=this.state,data=_this$state.data,error=_this$state.error,loading=_this$state.loading,success=_this$state.success,shipping=_this$state.shipping,billing=_this$state.billing;return/*#__PURE__*/React.createElement(\"div\",null,error&&/*#__PURE__*/React.createElement(Message,{error:true,header:\"There was some errors with your submission\",content:JSON.stringify(error)}),loading&&/*#__PURE__*/React.createElement(Segment,null,/*#__PURE__*/React.createElement(Dimmer,{active:true,inverted:true},/*#__PURE__*/React.createElement(Loader,{inverted:true},\"Loading\")),/*#__PURE__*/React.createElement(Image,{src:\"/images/wireframe/short-paragraph.png\"})),success&&/*#__PURE__*/React.createElement(Message,{positive:true},/*#__PURE__*/React.createElement(Message.Header,null,\"Your payment was successful\"),/*#__PURE__*/React.createElement(\"p\",null,\"Go to you \",/*#__PURE__*/React.createElement(\"b\",null,\"profile\"),\" to see the order delivery status.\")),/*#__PURE__*/React.createElement(OrderPreview,{data:data}),/*#__PURE__*/React.createElement(Divider,null),/*#__PURE__*/React.createElement(CouponForm,{handleAddCoupon:function handleAddCoupon(e,code){return _this3.handleAddCoupon(e,code);}}),/*#__PURE__*/React.createElement(Divider,null),billing.length>=1&&shipping.length>=1?/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(Header,null,\"Would you like to complete the purchase ?\"),/*#__PURE__*/React.createElement(\"form\",{onSubmit:this.handleSubmit},/*#__PURE__*/React.createElement(CardElement,null),/*#__PURE__*/React.createElement(Button,{secondary:true,type:\"submit\",disabled:!stripe,style:{marginTop:\"10px\"}// loading={loading}\n// disabled={loading}\n},\"Pay\"))):/*#__PURE__*/React.createElement(\"div\",null,\" \",/*#__PURE__*/React.createElement(Header,{as:\"h5\"},/*#__PURE__*/React.createElement(Link,{to:\"/profile\"},\"Please go to your profile and provide your addresses..\"))));}}]);return CheckoutForm;}(React.Component);var InjectedCheckoutForm=function InjectedCheckoutForm(){return/*#__PURE__*/React.createElement(Container,{text:true},/*#__PURE__*/React.createElement(\"h3\",null,\"Complete your Order\"),/*#__PURE__*/React.createElement(Elements,{stripe:stripePromise},/*#__PURE__*/React.createElement(ElementsConsumer,null,function(_ref2){var elements=_ref2.elements,stripe=_ref2.stripe;return/*#__PURE__*/React.createElement(CheckoutForm,{elements:elements,stripe:stripe});})));};export default InjectedCheckoutForm;","map":{"version":3,"sources":["C:/Users/Alexander/Desktop/important/ecommerceproject/root/front/src/containers/Checkout.js"],"names":["React","CardElement","ElementsConsumer","Link","Elements","loadStripe","Button","Container","Divider","Dimmer","Header","Item","Image","Label","Loader","Message","Segment","Form","checkoutURL","orderSummaryURL","addCouponURL","addressListURL","authAxios","stripePromise","OrderPreview","props","data","order_items","map","order_item","i","item","image","quantity","title","final_price","total","coupon","marginLeft","code","amount","CouponForm","state","handleChange","e","setState","target","value","handleSubmit","handleAddCoupon","Component","CheckoutForm","loading","error","success","billing","shipping","handleFetchBillingAddress","get","then","res","catch","err","handleFetchShippingAddress","handleFetchOrder","response","status","history","push","preventDefault","post","event","stripe","elements","cardElement","getElement","createPaymentMethod","type","card","paymentMethod","stripeToken","console","log","JSON","stringify","length","marginTop","InjectedCheckoutForm"],"mappings":"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","sourcesContent":["import React from \"react\";\r\nimport { CardElement, ElementsConsumer } from \"@stripe/react-stripe-js\";\r\nimport { Link } from \"react-router-dom\";\r\n\r\nimport { Elements } from \"@stripe/react-stripe-js\";\r\nimport { loadStripe } from \"@stripe/stripe-js\";\r\n\r\nimport {\r\n  Button,\r\n  Container,\r\n  Divider,\r\n  Dimmer,\r\n  Header,\r\n  Item,\r\n  Image,\r\n  Label,\r\n  Loader,\r\n  Message,\r\n  Segment,\r\n  Form,\r\n} from \"semantic-ui-react\";\r\n\r\nimport {\r\n  checkoutURL,\r\n  orderSummaryURL,\r\n  addCouponURL,\r\n  addressListURL,\r\n} from \"../containers/constants\";\r\n\r\nimport { authAxios } from \"../Utils\";\r\n\r\nconst stripePromise = loadStripe(\r\n  \"pk_test_51Ha0vNGV70HGHFAGYq6tdL9DjEXnL6uslIYoVA7TLvwLhW1EHWUWiMh0KM4PEkxkzCsy6Y0mbkjAdXCBzlPzJVbx00Mtss3kPN\"\r\n);\r\n\r\nconst OrderPreview = (props) => {\r\n  const { data } = props;\r\n  return (\r\n    <React.Fragment>\r\n      {data && (\r\n        <React.Fragment>\r\n          <Item.Group relaxed>\r\n            {data.order_items.map((order_item, i) => {\r\n              return (\r\n                <Item key={i}>\r\n                  <Item.Image\r\n                    size=\"tiny\"\r\n                    src={`http://127.0.0.1:8000${order_item.item.image}`}\r\n                  />\r\n\r\n                  <Item.Content verticalAlign=\"middle\">\r\n                    <Item.Header as=\"a\">\r\n                      {order_item.quantity} x {order_item.item.title}\r\n                    </Item.Header>\r\n\r\n                    <Item.Extra>\r\n                      <Label>$ {order_item.final_price}</Label>\r\n                    </Item.Extra>\r\n                  </Item.Content>\r\n                </Item>\r\n              );\r\n            })}\r\n          </Item.Group>\r\n\r\n          <Item.Group>\r\n            <Item.Content>\r\n              <Item.Header>\r\n                Order Total: ${data.total}\r\n                {data.coupon && (\r\n                  <Label color=\"green\" style={{ marginLeft: \"15px\" }}>\r\n                    Current Coupon: {data.coupon.code} for ${data.coupon.amount}\r\n                  </Label>\r\n                )}\r\n              </Item.Header>\r\n            </Item.Content>\r\n          </Item.Group>\r\n        </React.Fragment>\r\n      )}\r\n    </React.Fragment>\r\n  );\r\n};\r\n\r\nclass CouponForm extends React.Component {\r\n  state = {\r\n    code: \"\",\r\n  };\r\n\r\n  handleChange = (e) => {\r\n    this.setState({ code: e.target.value });\r\n  };\r\n\r\n  handleSubmit = (e) => {\r\n    const { code } = this.state;\r\n    this.props.handleAddCoupon(e, code);\r\n    this.setState({ code: \"\" });\r\n  };\r\n\r\n  render() {\r\n    const { code } = this.state;\r\n    return (\r\n      <React.Fragment>\r\n        <Form onSubmit={this.handleSubmit}>\r\n          <Form.Field>\r\n            <label>Coupong Code</label>\r\n            <input\r\n              placeholder=\"Enter a coupon\"\r\n              value={code}\r\n              onChange={this.handleChange}\r\n            />\r\n          </Form.Field>\r\n          <Button type=\"submit\">Submit</Button>\r\n        </Form>\r\n      </React.Fragment>\r\n    );\r\n  }\r\n}\r\n\r\nclass CheckoutForm extends React.Component {\r\n  state = {\r\n    loading: true,\r\n    error: null,\r\n    success: false,\r\n    data: null,\r\n    billing: [],\r\n    shipping: [],\r\n  };\r\n\r\n  componentDidMount() {\r\n    this.handleFetchOrder();\r\n  }\r\n\r\n  handleFetchBillingAddress = () => {\r\n    // this.setState({ loading: true });\r\n    const { billing } = this.state;\r\n\r\n    authAxios\r\n      .get(addressListURL(\"B\"))\r\n      .then((res) => {\r\n        // this.setState({ billing: res.data, loading: false });\r\n        this.setState({ billing: res.data });\r\n      })\r\n      .catch((err) => {\r\n        this.setState({ error: err });\r\n      });\r\n  };\r\n\r\n  handleFetchShippingAddress = () => {\r\n    // this.setState({ loading: true });\r\n    const { shipping } = this.state;\r\n    authAxios\r\n      .get(addressListURL(\"S\"))\r\n      .then((res) => {\r\n        // this.setState({ shipping: res.data, loading: false });\r\n        this.setState({ shipping: res.data });\r\n      })\r\n      .catch((err) => {\r\n        this.setState({ error: err });\r\n      });\r\n  };\r\n\r\n  handleFetchOrder = () => {\r\n    this.setState({ loading: true });\r\n    authAxios\r\n      .get(orderSummaryURL)\r\n      .then((res) => {\r\n        this.setState({ data: res.data, loading: false });\r\n        this.handleFetchBillingAddress();\r\n        this.handleFetchShippingAddress();\r\n      })\r\n      .catch((err) => {\r\n        if (err.response.status === 404) {\r\n          this.props.history.push(\"/products\");\r\n        } else {\r\n          this.setState({ error: err, loading: false });\r\n        }\r\n      });\r\n  };\r\n  handleAddCoupon = (e, code) => {\r\n    e.preventDefault();\r\n    this.setState({ loading: true });\r\n\r\n    authAxios\r\n      .post(addCouponURL, { code })\r\n      .then((res) => {\r\n        this.setState({ loading: false });\r\n        this.handleFetchOrder();\r\n      })\r\n      .catch((err) => {\r\n        this.setState({ error: err, loading: false });\r\n      });\r\n  };\r\n\r\n  handleSubmit = async (event) => {\r\n    // Block native form submission.\r\n    event.preventDefault();\r\n\r\n    const { stripe, elements } = this.props;\r\n\r\n    if (!stripe || !elements) {\r\n      // Stripe.js has not loaded yet. Make sure to disable\r\n      // form submission until Stripe.js has loaded.\r\n      return;\r\n    }\r\n\r\n    this.setState({ loading: true });\r\n    // Get a reference to a mounted CardElement. Elements knows how\r\n    // to find your CardElement because there can only ever be one of\r\n    // each type of element.\r\n    const cardElement = elements.getElement(CardElement);\r\n\r\n    const { error, paymentMethod } = await stripe.createPaymentMethod({\r\n      type: \"card\",\r\n      card: cardElement,\r\n    });\r\n    authAxios\r\n      .post(checkoutURL, { stripeToken: paymentMethod.card })\r\n      .then((res) => {\r\n        this.setState({ loading: false, success: true });\r\n      })\r\n      .catch((err) => {\r\n        this.setState({ loading: false, error: err });\r\n      });\r\n\r\n    if (error) {\r\n      console.log(\"[error]\", error);\r\n    } else {\r\n      console.log(\"[PaymentMethod]\", paymentMethod);\r\n    }\r\n  };\r\n\r\n  render() {\r\n    const { stripe } = this.props;\r\n    const { data, error, loading, success, shipping, billing } = this.state;\r\n    return (\r\n      <div>\r\n        {error && (\r\n          <Message\r\n            error\r\n            header=\"There was some errors with your submission\"\r\n            content={JSON.stringify(error)}\r\n          />\r\n        )}\r\n        {loading && (\r\n          <Segment>\r\n            <Dimmer active inverted>\r\n              <Loader inverted>Loading</Loader>\r\n            </Dimmer>\r\n\r\n            <Image src=\"/images/wireframe/short-paragraph.png\" />\r\n          </Segment>\r\n        )}\r\n        {success && (\r\n          <Message positive>\r\n            <Message.Header>Your payment was successful</Message.Header>\r\n            <p>\r\n              Go to you <b>profile</b> to see the order delivery status.\r\n            </p>\r\n          </Message>\r\n        )}\r\n        <OrderPreview data={data} />\r\n        <Divider />\r\n        <CouponForm\r\n          handleAddCoupon={(e, code) => this.handleAddCoupon(e, code)}\r\n        />\r\n        <Divider />\r\n\r\n        {billing.length >= 1 && shipping.length >= 1 ? (\r\n          <div>\r\n            <Header>Would you like to complete the purchase ?</Header>\r\n\r\n            <form onSubmit={this.handleSubmit}>\r\n              <CardElement />\r\n\r\n              <Button\r\n                secondary\r\n                type=\"submit\"\r\n                disabled={!stripe}\r\n                style={{ marginTop: \"10px\" }}\r\n                // loading={loading}\r\n                // disabled={loading}\r\n              >\r\n                Pay\r\n              </Button>\r\n            </form>\r\n          </div>\r\n        ) : (\r\n          <div>\r\n            {\" \"}\r\n            <Header as=\"h5\">\r\n              <Link to=\"/profile\">\r\n                Please go to your profile and provide your addresses..\r\n              </Link>\r\n            </Header>\r\n          </div>\r\n        )}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nconst InjectedCheckoutForm = () => {\r\n  return (\r\n    <Container text>\r\n      <h3>Complete your Order</h3>\r\n      <Elements stripe={stripePromise}>\r\n        <ElementsConsumer>\r\n          {({ elements, stripe }) => (\r\n            <CheckoutForm elements={elements} stripe={stripe} />\r\n          )}\r\n        </ElementsConsumer>\r\n      </Elements>\r\n    </Container>\r\n  );\r\n};\r\n\r\nexport default InjectedCheckoutForm;\r\n"]},"metadata":{},"sourceType":"module"}